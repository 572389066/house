"use strict";const u=require("../common/vendor.js"),p=require("./cache.js"),f="https://zykjstore.oss-cn-chengdu.aliyuncs.com";let d="";d="https://houseapi.cqsoftware.cn";function h(o,e){let a=p.cache.getToken(),i={"content-type":"application/x-www-form-urlencoded"};return a&&a.length>0&&(i.uid=a),new Promise((t,s)=>{u.index.request({url:d+o,data:e,header:i,method:"POST",success:n=>{let c=n.data;c.code===1?t(c.return):(s(c),l(c))},fail:n=>{n&&n.response&&(s(n.response),l(n.response))}})})}function r(o,e){return new Promise((a,i)=>{u.index.request({url:d+o,data:e,header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",success:t=>{let s=t.data;s.code===1?a(s.return):(i(s),l(s))},fail:t=>{t&&t.response&&(i(t),l(t.response))}})})}function m(o,e={}){let a=p.cache.getToken(),i={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"};return a&&a.length>0&&(i.uid=a),new Promise((t,s)=>{u.index.request({url:d+o,data:e,header:i,method:"GET",success:n=>{let c=n.data;c.code==1?t(c.return):(s(c),l(c))},fail:n=>{console.log("get request fail: "+JSON.stringify(n)),n&&n.response&&(s(n.response),l(n.response))}})})}function g(o,e){return new Promise((a,i)=>{u.index.uploadFile({url:d+o,filePath:e,name:"file",formData:{},success:t=>{let s=JSON.parse(t.data);s.code===1?a(s.return):(i(s),l(s))},fail:t=>{t&&t.response&&(i(t),l(t.response))}})})}const l=o=>{let e="";if(o.msg&&o.msg!="")e=o.msg;else switch(o.code){case 300:e="未授权，请登录";break;case 400:e="请求参数错误";break;case 403:e="跨域拒绝访问";break;case 404:e="请求地址不存在";break;case 500:e="服务器内部错误";break;case 504:e="请求超时";break;default:e="请求失败";break}u.index.showToast({title:e,icon:"none",duration:3e3,complete:function(){setTimeout(function(){u.index.hideToast()},3e3)}}),o.code==300&&setTimeout(function(){w()},500)};function w(){p.cache.saveToken(""),u.index.navigateTo({url:"/pages/login/login"})}exports.HOST_IMG=f;exports.get=m;exports.post=h;exports.postWithoutToken=r;exports.upload=g;

"use strict";const h=require("../../../../../../common/vendor.js"),s=require("../z-paging-utils.js"),n=require("../z-paging-enum.js"),a={props:{usePageScroll:{type:Boolean,default:s.u.gc("usePageScroll",!1)},scrollable:{type:Boolean,default:s.u.gc("scrollable",!0)},showScrollbar:{type:Boolean,default:s.u.gc("showScrollbar",!0)},scrollX:{type:Boolean,default:s.u.gc("scrollX",!1)},scrollToTopBounceEnabled:{type:Boolean,default:s.u.gc("scrollToTopBounceEnabled",!1)},scrollToBottomBounceEnabled:{type:Boolean,default:s.u.gc("scrollToBottomBounceEnabled",!0)},scrollWithAnimation:{type:Boolean,default:s.u.gc("scrollWithAnimation",!1)},scrollIntoView:{type:String,default:s.u.gc("scrollIntoView","")}},data(){return{scrollTop:0,oldScrollTop:0,scrollViewStyle:{},scrollViewContainerStyle:{},scrollViewInStyle:{},pageScrollTop:-1,scrollEnable:!0,privateScrollWithAnimation:-1,cacheScrollNodeHeight:-1}},watch:{oldScrollTop(o){!this.usePageScroll&&this._scrollTopChange(o,!1)},pageScrollTop(o){this.usePageScroll&&this._scrollTopChange(o,!0)},usePageScroll:{handler(o){this.loaded&&this.autoHeight&&this._setAutoHeight(!o)},immediate:!0},finalScrollTop(o){this.useChatRecordMode||(this.renderPropScrollTop=o<6?0:10)}},computed:{finalScrollWithAnimation(){if(this.privateScrollWithAnimation!==-1){const o=this.privateScrollWithAnimation===1;return this.privateScrollWithAnimation=-1,o}return this.scrollWithAnimation},finalScrollViewStyle(){return this.superContentZIndex!=1&&(this.scrollViewStyle["z-index"]=this.superContentZIndex,this.scrollViewStyle.position="relative"),this.scrollViewStyle},finalScrollTop(){return this.usePageScroll?this.pageScrollTop:this.oldScrollTop},finalIsOldWebView(){return this.isOldWebView&&!this.usePageScroll}},methods:{scrollToTop(o,t=!0){this.$nextTick(()=>{this._scrollToTop(o,!1)})},scrollToBottom(o,t=!0){this.$nextTick(()=>{this._scrollToBottom(o)})},scrollIntoViewById(o,t,l){this._scrollIntoView(o,t,l)},scrollIntoViewByNodeTop(o,t,l){this.scrollTop=this.oldScrollTop,this.$nextTick(()=>{this._scrollIntoViewByNodeTop(o,t,l)})},scrollToY(o,t,l){this.scrollTop=this.oldScrollTop,this.$nextTick(()=>{this._scrollToY(o,t,l)})},scrollIntoViewByIndex(o,t,l){this._scrollIntoView(o,t,l)},scrollIntoViewByView(o,t,l){this._scrollIntoView(o,t,l)},updatePageScrollTop(o){this.pageScrollTop=o},updatePageScrollTopHeight(){this._updatePageScrollTopOrBottomHeight("top")},updatePageScrollBottomHeight(){this._updatePageScrollTopOrBottomHeight("bottom")},updateLeftAndRightWidth(){this.$nextTick(()=>{this._updateLeftAndRightWidth()})},updateScrollViewScrollTop(o,t=!0){this.privateScrollWithAnimation=t?1:0,this.scrollTop=this.oldScrollTop,this.$nextTick(()=>{this.scrollTop=o,this.oldScrollTop=this.scrollTop})},_onScrollToUpper(){this.$emit("scrolltoupper"),this.$emit("scrollTopChange",0),this.$nextTick(()=>{this.oldScrollTop=0}),this.useChatRecordMode&&this.loadingStatus!==n.Enum.More.NoMore&&this._onLoadingMore("click")},_onScrollToLower(o){(!o.detail||!o.detail.direction||o.detail.direction==="bottom")&&this._onLoadingMore("toBottom")},_scrollToTop(o=!0,t=!0){if(this.usePageScroll){this.$nextTick(()=>{h.index.pageScrollTo({scrollTop:0,duration:o?100:0})});return}this.privateScrollWithAnimation=o?1:0,this.scrollTop=this.oldScrollTop,this.$nextTick(()=>{this.scrollTop=0,this.oldScrollTop=this.scrollTop})},async _scrollToBottom(o=!0){if(this.usePageScroll){this.$nextTick(()=>{h.index.pageScrollTo({scrollTop:Number.MAX_VALUE,duration:o?100:0})});return}try{this.privateScrollWithAnimation=o?1:0;const t=await this._getNodeClientRect(".zp-paging-container"),l=await this._getNodeClientRect(".zp-scroll-view"),e=t?t[0].height:0,i=l?l[0].height:0;e>i&&(this.scrollTop=this.oldScrollTop,this.$nextTick(()=>{this.scrollTop=e-i+this.virtualPlaceholderTopHeight,this.oldScrollTop=this.scrollTop}))}catch{}},_scrollIntoView(o,t=0,l=!1,e){try{this.scrollTop=this.oldScrollTop,this.$nextTick(()=>{this._getNodeClientRect("#"+o.replace("#",""),this.$parent).then(i=>{if(i){let r=i[0].top;this._scrollIntoViewByNodeTop(r,t,l),e&&e()}})})}catch{}},_scrollIntoViewByNodeTop(o,t=0,l=!1){this._scrollToY(o,t,l,!0)},_scrollToY(o,t=0,l=!1,e=!1){this.privateScrollWithAnimation=l?1:0,this.usePageScroll?h.index.pageScrollTo({scrollTop:o-t,duration:l?100:0}):(e&&(o+=this.oldScrollTop),this.scrollTop=o-t,this.oldScrollTop=this.scrollTop)},_scroll(o){this.$emit("scroll",o);const t=o.detail.scrollTop;this.finalUseVirtualList&&this._updateVirtualScroll(t,this.oldScrollTop-t),this.oldScrollTop=t;const l=o.detail.scrollHeight-this.oldScrollTop;!this.isIos&&this._checkScrolledToBottom(l)},_doCheckScrollViewShouldFullHeight(o){this.autoFullHeight&&this.usePageScroll&&this.isTotalChangeFromAddData?this.$nextTick(()=>{this._checkScrollViewShouldFullHeight((t,l)=>{this._preCheckShowNoMoreInside(o,t,l)})}):this._preCheckShowNoMoreInside(o)},async _checkScrollViewShouldFullHeight(o){try{const t=await this._getNodeClientRect(".zp-scroll-view"),l=await this._getNodeClientRect(".zp-paging-container-content");if(!t||!l)return;const e=l[0].height,i=t[0].top;this.isAddedData&&e+i<=this.windowHeight?(this._setAutoHeight(!0,t),o(t,l)):(this._setAutoHeight(!1),o(null,null))}catch{o(null,null)}},_scrollTopChange(o,t){this.$emit("scrollTopChange",o),this.$emit("update:scrollTop",o),this._checkShouldShowBackToTop(o);const l=this.isIos?o>5?6:0:o;t?this.wxsPageScrollTop=l:this.wxsScrollTop=l},_updatePageScrollTopOrBottomHeight(o){if(!this.usePageScroll)return;this._doCheckScrollViewShouldFullHeight(this.realTotalData);const t=`.zp-page-${o}`,l=`margin${o.slice(0,1).toUpperCase()+o.slice(1)}`;let e=this.safeAreaInsetBottom;this.$nextTick(()=>{setTimeout(()=>{this._getNodeClientRect(t).then(r=>{if(r){let c=r[0].height;o==="bottom"?e&&(c+=this.safeAreaBottom):this.cacheTopHeight=c,this.$set(this.scrollViewStyle,l,`${c}px`)}else e&&this.$set(this.scrollViewStyle,l,`${this.safeAreaBottom}px`)})},0)})},_updateLeftAndRightWidth(){this.finalIsOldWebView&&this.$nextTick(()=>{setTimeout(()=>{["left","right"].map(t=>{this._getNodeClientRect(`.zp-page-${t}`).then(l=>{this.$set(this.scrollViewContainerStyle,t,l?l[0].width+"px":"0px")})})},0)})}}};exports.scrollerModule=a;

"use strict";const e=require("../z-paging-utils.js"),t=require("../z-paging-enum.js"),d={props:{loadingMoreCustomStyle:{type:Object,default:function(){return e.u.gc("loadingMoreCustomStyle",{})}},loadingMoreTitleCustomStyle:{type:Object,default:function(){return e.u.gc("loadingMoreTitleCustomStyle",{})}},loadingMoreLoadingIconCustomStyle:{type:Object,default:function(){return e.u.gc("loadingMoreLoadingIconCustomStyle",{})}},loadingMoreLoadingIconType:{type:String,default:e.u.gc("loadingMoreLoadingIconType","flower")},loadingMoreLoadingIconCustomImage:{type:String,default:e.u.gc("loadingMoreLoadingIconCustomImage","")},loadingMoreLoadingAnimated:{type:Boolean,default:e.u.gc("loadingMoreLoadingAnimated",!0)},loadingMoreEnabled:{type:Boolean,default:e.u.gc("loadingMoreEnabled",!0)},toBottomLoadingMoreEnabled:{type:Boolean,default:e.u.gc("toBottomLoadingMoreEnabled",!0)},loadingMoreDefaultAsLoading:{type:[Boolean],default:e.u.gc("loadingMoreDefaultAsLoading",!1)},loadingMoreDefaultText:{type:[String,Object],default:e.u.gc("loadingMoreDefaultText",null)},loadingMoreLoadingText:{type:[String,Object],default:e.u.gc("loadingMoreLoadingText",null)},loadingMoreNoMoreText:{type:[String,Object],default:e.u.gc("loadingMoreNoMoreText",null)},loadingMoreFailText:{type:[String,Object],default:e.u.gc("loadingMoreFailText",null)},hideNoMoreInside:{type:Boolean,default:e.u.gc("hideNoMoreInside",!1)},hideNoMoreByLimit:{type:Number,default:e.u.gc("hideNoMoreByLimit",0)},showDefaultLoadingMoreText:{type:Boolean,default:e.u.gc("showDefaultLoadingMoreText",!0)},showLoadingMoreNoMoreView:{type:Boolean,default:e.u.gc("showLoadingMoreNoMoreView",!0)},showLoadingMoreNoMoreLine:{type:Boolean,default:e.u.gc("showLoadingMoreNoMoreLine",!0)},loadingMoreNoMoreLineCustomStyle:{type:Object,default:function(){return e.u.gc("loadingMoreNoMoreLineCustomStyle",{})}},insideMore:{type:Boolean,default:e.u.gc("insideMore",!1)},lowerThreshold:{type:[Number,String],default:e.u.gc("lowerThreshold","100rpx")}},data(){return{M:t.Enum.More,loadingStatus:t.Enum.More.Default,loadingStatusAfterRender:t.Enum.More.Default,loadingMoreTimeStamp:0,loadingMoreDefaultSlot:null,showLoadingMore:!1,customNoMore:-1}},computed:{zLoadMoreConfig(){return{status:this.loadingStatusAfterRender,defaultAsLoading:this.loadingMoreDefaultAsLoading,defaultThemeStyle:this.finalLoadingMoreThemeStyle,customStyle:this.loadingMoreCustomStyle,titleCustomStyle:this.loadingMoreTitleCustomStyle,iconCustomStyle:this.loadingMoreLoadingIconCustomStyle,loadingIconType:this.loadingMoreLoadingIconType,loadingIconCustomImage:this.loadingMoreLoadingIconCustomImage,loadingAnimated:this.loadingMoreLoadingAnimated,showNoMoreLine:this.showLoadingMoreNoMoreLine,noMoreLineCustomStyle:this.loadingMoreNoMoreLineCustomStyle,defaultText:this.finalLoadingMoreDefaultText,loadingText:this.finalLoadingMoreLoadingText,noMoreText:this.finalLoadingMoreNoMoreText,failText:this.finalLoadingMoreFailText,hideContent:!this.loadingMoreDefaultAsLoading&&this.listRendering}},finalLoadingMoreThemeStyle(){return this.loadingMoreThemeStyle.length?this.loadingMoreThemeStyle:this.defaultThemeStyle},showLoadingMoreDefault(){return this._showLoadingMore("Default")},showLoadingMoreLoading(){return this._showLoadingMore("Loading")},showLoadingMoreNoMore(){return this._showLoadingMore("NoMore")},showLoadingMoreFail(){return this._showLoadingMore("Fail")},showLoadingMoreCustom(){return this._showLoadingMore("Custom")}},methods:{pageReachBottom(){!this.useChatRecordMode&&this._onLoadingMore("toBottom")},doLoadMore(o){this._onLoadingMore(o)},_checkScrolledToBottom(o,a=!1){this.checkScrolledToBottomTimeOut&&(clearTimeout(this.checkScrolledToBottomTimeOut),this.checkScrolledToBottomTimeOut=null),this.cacheScrollNodeHeight===-1?this._getNodeClientRect(".zp-scroll-view").then(n=>{if(n){let i=n[0].height;this.cacheScrollNodeHeight=i,o-i<=this.finalLowerThreshold&&this._onLoadingMore("toBottom")}}):o-this.cacheScrollNodeHeight<=this.finalLowerThreshold?this._onLoadingMore("toBottom"):o-this.cacheScrollNodeHeight<=500&&!a&&(this.checkScrolledToBottomTimeOut=setTimeout(()=>{this._getNodeClientRect(".zp-scroll-view",!0,!0).then(n=>{this.oldScrollTop=n[0].scrollTop;const i=n[0].scrollHeight-this.oldScrollTop;this._checkScrolledToBottom(i,!0)})},150))},_onLoadingMore(o="click"){if(o==="toBottom"&&!this.scrollToBottomBounceEnabled&&this.scrollEnable&&(this.scrollEnable=!1,this.$nextTick(()=>{this.scrollEnable=!0})),this.$emit("scrolltolower",o),!(o==="toBottom"&&(!this.toBottomLoadingMoreEnabled||this.useChatRecordMode))&&!(this.refresherOnly||!this.loadingMoreEnabled||!(this.loadingStatus===t.Enum.More.Default||this.loadingStatus===t.Enum.More.Fail)||this.loading)){if(!this.isIos&&!this.refresherOnly&&!this.usePageScroll){const a=e.u.getTime();if(this.loadingMoreTimeStamp>0&&a-this.loadingMoreTimeStamp<100){this.loadingMoreTimeStamp=0;return}}this._doLoadingMore()}},_doLoadingMore(){this.pageNo>=this.defaultPageNo&&this.loadingStatus!==t.Enum.More.NoMore&&(this.pageNo++,this._startLoading(!1),this.isLocalPaging?this._localPagingQueryList(this.pageNo,this.defaultPageSize,this.localPagingLoadingTime,o=>{this.completeByTotal(o,this.totalLocalPagingList.length)}):(this._emitQuery(this.pageNo,this.defaultPageSize,t.Enum.QueryFrom.LoadingMore),this._callMyParentQuery()),this.loadingType=t.Enum.LoadingType.LoadingMore)},_preCheckShowNoMoreInside(o,a,n){this.loadingStatus===t.Enum.More.NoMore&&this.hideNoMoreByLimit>0&&o.length?this.showLoadingMore=o.length>this.hideNoMoreByLimit:this.loadingStatus===t.Enum.More.NoMore&&this.hideNoMoreInside&&o.length||this.insideMore&&this.insideOfPaging!==!1&&o.length?(this.$nextTick(()=>{this._checkShowNoMoreInside(o,a,n)}),this.insideMore&&this.insideOfPaging!==!1&&o.length&&(this.showLoadingMore=o.length)):this.showLoadingMore=o.length},async _checkShowNoMoreInside(o,a,n){try{const i=a||await this._getNodeClientRect(".zp-scroll-view");if(this.usePageScroll){if(i){const s=i[0].top+i[0].height;this.insideOfPaging=s<this.windowHeight,this.hideNoMoreInside&&(this.showLoadingMore=!this.insideOfPaging),this._updateInsideOfPaging()}}else{const s=n||await this._getNodeClientRect(".zp-paging-container-content"),l=s?s[0].height:0,r=i?i[0].height:0;this.insideOfPaging=l<r,this.hideNoMoreInside&&(this.showLoadingMore=!this.insideOfPaging),this._updateInsideOfPaging()}}catch{this.insideOfPaging=!o.length,this.hideNoMoreInside&&(this.showLoadingMore=!this.insideOfPaging),this._updateInsideOfPaging()}},_showLoadingMore(o){return!this.showLoadingMoreWhenReload&&(!(this.loadingStatus!==t.Enum.More.Default||this.nShowBottom)||!this.realTotalData.length)||(!this.showLoadingMoreWhenReload||this.isUserPullDown||this.loadingStatus!==t.Enum.More.Loading)&&!this.showLoadingMore||!this.loadingMoreEnabled&&(!this.showLoadingMoreWhenReload||this.isUserPullDown||this.loadingStatus!==t.Enum.More.Loading)||this.refresherOnly||this.useChatRecordMode&&o!=="Loading"||!this.$slots?!1:o==="Custom"?this.showDefaultLoadingMoreText&&!(this.loadingStatus===t.Enum.More.NoMore&&!this.showLoadingMoreNoMoreView):this.loadingStatus===t.Enum.More[o]&&this.$slots[`loadingMore${o}`]&&(o==="NoMore"?this.showLoadingMoreNoMoreView:!0)}}};exports.loadMoreModule=d;

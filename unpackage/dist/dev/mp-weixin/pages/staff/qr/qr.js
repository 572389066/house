"use strict";const s=require("../../../utils/cache.js"),n=require("../../../common/vendor.js"),o={data(){return{channel:null,currentBuilding:null,qrCodeImage:null,role:"1",scene:"",intervalId:null,clientRecord:[],salesRecord:[],toastIntervalId:null,taostClientData:[],toastSalesData:[]}},onLoad(r){r.id&&r.name?this.channel={id:r.id,name:r.name}:this.$msg("获取渠道失败"),this.currentBuilding=s.cache.getCurrentBuilding(),this.currentBuilding||this.$msg("请先选择楼盘"),this.fetchCheckCode()},onUnload(){this.intervalId&&clearInterval(this.intervalId),this.toastIntervalId&&clearInterval(this.toastIntervalId)},methods:{onClickReset(){this.qrCodeImage=null,this.fetchCheckCode()},onChangeRole(){this.role==="2"?this.role="1":this.role="2"},fetchCheckCode(){this.$staffApi.fetchCheckCode(this.currentBuilding.id,this.channel.id).then(r=>{this.qrCodeImage=r,this.scene=r.scene,this.startInterval()}).catch(r=>{this.qrCodeImage=null})},fetchScanRecord(){this.$staffApi.fetchScanRecord(this.scene).then(r=>{this.clientRecord=r.client,this.salesRecord=r.sales}).catch(r=>{this.clientRecord=[],this.salesRecord=[]})},startInterval(){let r=this;this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(function(){r.fetchScanRecord()},2e3)}}};function h(r,d,f,I,e,t){return n.e({a:e.channel},e.channel?{b:n.t(e.channel.name)}:{},{c:e.qrCodeImage},e.qrCodeImage?n.e({d:e.role==="1"},e.role==="1"?{e:e.qrCodeImage.client}:e.role==="2"?{g:e.qrCodeImage.sales}:{},{f:e.role==="2"}):{},{h:e.channel&&e.role==="2"},e.channel&&e.role==="2"?{}:e.role==="1"?{}:{},{i:e.role==="1",j:e.role==="1"},e.role==="1"?{}:{},{k:e.role==="2"},e.role==="2"?{}:{},{l:n.o(l=>t.onChangeRole()),m:n.o(l=>t.onClickReset()),n:e.role==="1"},e.role==="1"?n.e({o:e.clientRecord},e.clientRecord?{p:n.t(e.clientRecord.length)}:{},{q:e.clientRecord},e.clientRecord?{r:n.f(e.clientRecord,(l,c,i)=>({a:n.t(l.phone)}))}:{}):e.role==="2"?n.e({t:e.salesRecord},e.salesRecord?{v:n.f(e.salesRecord,(l,c,i)=>({a:n.t(l.phone)}))}:{}):{},{s:e.role==="2"})}const u=n._export_sfc(o,[["render",h],["__scopeId","data-v-ed94f8f7"],["__file","D:/HBuilderProjects/house/pages/staff/qr/qr.vue"]]);wx.createPage(u);

"use strict";const e=require("../../../common/vendor.js"),h=require("../../../utils/urlUtil.js");require("../../../utils/request.js");require("../../../utils/cache.js");const p={data(){return{recordData:[],buildingData:[],channelData:[],currentBuilding:null,roleTypeData:[{id:"Customer",name:"客户"},{id:"Sales",name:"中介"}],roleType:null,channel:null,roleTypeTmp:null,channelTmp:null,filterDate:"",filterDateTmp:"",nowTime:0,searchKey:""}},onLoad(){this.nowTime=Date.now(),this.fetchChannel()},onShow(){this.$refs.paging.reload()},methods:{getImageUrl(n){return h.urlUtil.getImgUrlNotSize(n)},previewImage(n){let s=this.getPictures(n);s.length!=0&&e.index.previewImage({urls:s,success:l=>{}})},onClickSearch(n){this.searchKey=n.value,this.$refs.paging.reload()},onSearchInput(n){this.searchKey=n,this.$refs.paging.reload()},onSearchClear(n){this.searchKey="",this.$refs.paging.reload()},getDisplayRole(n){if(n&&n.type){if(n.type=="Customer")return"客户";if(n.type=="Sales")return"中介"}return"--"},onDateChange(n){this.filterDateTmp=n,this.$refs.paging.reload()},showBuildingPicker(){this.$refs.buildingPicker.open()},closeBuildingPicker(){this.$refs.buildingPicker.close()},bindCurrentBuilding(n){this.currentBuilding=n,this.closeBuildingPicker(),this.$refs.paging.reload()},showFilterPicker(){this.roleTypeTmp=this.roleType,this.channelTmp=this.channel,this.filterDateTmp=this.filterDate,this.$refs.filterPicker.open()},closeFilterPicker(){this.$refs.filterPicker.close()},isSelectRoleType(n){return this.roleTypeTmp&&n&&this.roleTypeTmp.id==n.id},isSelectChannel(n){return this.channelTmp&&n&&this.channelTmp.id==n.id},onRoleTypeSelected(n){this.roleTypeTmp&&n&&n.id==this.roleTypeTmp.id?this.roleTypeTmp=null:this.roleTypeTmp=n},onChannelSelected(n){this.channelTmp&&n&&this.channelTmp.id==n.id?this.channelTmp=null:this.channelTmp=n},onFilterResetClick(){this.roleTypeTmp=null,this.channelTmp=null,this.filterDateTmp=""},onFilterConfirmClick(){this.roleType=this.roleTypeTmp,this.channel=this.channelTmp,this.filterDate=this.filterDateTmp,this.closeFilterPicker(),this.$refs.paging.reload()},fetchBuilding(n,s){this.$staffApi.fetchBuildingList(n,s,"","","").then(l=>{l.unshift({id:"",name:"全部楼盘"}),this.$refs.buildingPaging.complete(l)}).catch(l=>{this.$refs.buildingPaging.complete(!1)})},fetchChannel(){this.$staffApi.fetchChannel().then(n=>{this.channelData=n}).catch(n=>{})},fetchRecord(n,s){let l=this.currentBuilding?this.currentBuilding.id:"",c=this.searchKey,r=this.filterDate,t=this.channel?this.channel.id:"",i=this.roleType?this.roleType.id:"";this.$staffApi.fetchCustomerList(n,s,l,c,r,t,i).then(a=>{this.$refs.paging.complete(a)}).catch(a=>{this.$refs.paging.complete(!1)})},onItemClick(n){n&&n.type=="Customer"&&e.index.navigateTo({url:"/pages/staff/qr/transfer?record="+encodeURIComponent(JSON.stringify(n))})},getPictures(n){let s=[];if(n&&n.pictures&&n.pictures.length>0)for(var l=0;l<n.pictures.length;l++){let c=n.pictures[l];c&&c!=""&&s.push(this.getImageUrl(c))}return s}}};if(!Array){const n=e.resolveComponent("uni-search-bar"),s=e.resolveComponent("z-paging"),l=e.resolveComponent("uni-icons"),c=e.resolveComponent("uni-popup"),r=e.resolveComponent("uni-datetime-picker");(n+s+l+c+r)()}const g=()=>"../../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js",f=()=>"../../../uni_modules/z-paging/components/z-paging/z-paging.js",d=()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",m=()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js",T=()=>"../../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js";Math||(g+f+d+m+T)();function _(n,s,l,c,r,t){return e.e({a:e.o(t.onClickSearch),b:e.o(t.onSearchInput),c:e.o(t.onSearchClear),d:e.o(t.onSearchClear),e:e.p({placeholder:"请输入登记名称/电话",["bg-color"]:"#ffffff"}),f:e.t(r.currentBuilding?r.currentBuilding.name:"全部楼盘"),g:e.o(i=>t.showBuildingPicker()),h:e.o(i=>t.showFilterPicker()),i:e.f(r.recordData,(i,a,u)=>e.e({a:e.t(i.build_name),b:t.getPictures(i).length>0},t.getPictures(i).length>0?{}:{},{c:e.o(o=>t.previewImage(i)),d:e.t(i.create_time?i.create_time:"--"),e:e.t(i.staff_username?i.staff_username:"--"),f:e.t(i.user_phone?i.user_phone:"--"),g:e.t(t.getDisplayRole(i)),h:e.t(i.channel?i.channel:"--"),i:e.t(i.related_phone?i.related_phone:"--"),j:e.t(i.description?i.description:"--"),k:e.o(o=>t.onItemClick(i))})),j:e.sr("paging","5e6007af-0"),k:e.o(t.fetchRecord),l:e.o(i=>r.recordData=i),m:e.p({["default-page-size"]:"20",auto:!1,modelValue:r.recordData}),n:e.p({type:"closeempty",size:"20",color:"#999999"}),o:e.o((...i)=>t.closeBuildingPicker&&t.closeBuildingPicker(...i)),p:e.f(r.buildingData,(i,a,u)=>({a:e.t(i.name),b:e.o(o=>t.bindCurrentBuilding(i))})),q:e.sr("buildingPaging","5e6007af-3,5e6007af-2"),r:e.o(t.fetchBuilding),s:e.o(i=>r.buildingData=i),t:e.p({fixed:!1,modelValue:r.buildingData}),v:e.sr("buildingPicker","5e6007af-2"),w:e.p({type:"bottom"}),x:e.p({type:"closeempty",size:"20",color:"#999999"}),y:e.o((...i)=>t.closeFilterPicker&&t.closeFilterPicker(...i)),z:e.f(r.roleTypeData,(i,a,u)=>e.e({a:r.roleTypeTmp&&i&&r.roleTypeTmp.id==i.id},r.roleTypeTmp&&i&&r.roleTypeTmp.id==i.id?{b:e.t(i.name),c:e.o(o=>t.onRoleTypeSelected(i))}:{d:e.t(i.name),e:e.o(o=>t.onRoleTypeSelected(i))})),A:e.f(r.channelData,(i,a,u)=>e.e({a:r.channelTmp&&i&&r.channelTmp.id==i.id},r.channelTmp&&i&&r.channelTmp.id==i.id?{b:e.t(i.name),c:e.o(o=>t.onChannelSelected(i))}:{d:e.t(i.name),e:e.o(o=>t.onChannelSelected(i))})),B:r.filterDateTmp&&r.filterDateTmp!=""},r.filterDateTmp&&r.filterDateTmp!=""?{C:e.t(r.filterDateTmp==""?"全部":r.filterDateTmp)}:{},{D:e.o(t.onDateChange),E:e.o(i=>n.single=i),F:e.p({type:"date",end:r.nowTime,modelValue:n.single}),G:e.o(i=>t.onFilterResetClick()),H:e.o(i=>t.onFilterConfirmClick()),I:e.sr("filterPicker","5e6007af-5"),J:e.p({type:"bottom"})})}const y=e._export_sfc(p,[["render",_],["__file","D:/HBuilderProjects/house/pages/staff/qr/record.vue"]]);wx.createPage(y);

"use strict";const s=require("../../common/vendor.js"),c=require("../../utils/urlUtil.js"),a=require("../../utils/cache.js");require("../../utils/request.js");const h={data(){return{buildingId:"",scene:"",userCard:null,buildingDetail:null,uploadResult:[]}},onLoad(e){this.buildingId=e.buildingId,this.scene=e.scene,s.index.setNavigationBarTitle({title:"登记"}),this.fetchBuilding()},onShow(){this.checkLogin()&&this.fetchUserCard()},methods:{goFun(){s.index.navigateTo({url:"/pages/register/edit?type=2"})},getImageUrl(e){return c.urlUtil.getImgUrl(e)},onClickDelete(e){if(this.uploadResult&&this.uploadResult.length>e){this.uploadResult.splice(e,1);let l=this.uploadResult;this.uploadResult=l}},onClickUpload(){let e=4;this.uploadResult&&(e=4-this.uploadResult.length),e>0&&s.index.chooseMedia({count:1,mediaType:["image"],sourceType:["album","camera"],maxDuration:30,camera:"back",sizeType:["compressed"],success:l=>{if(l&&l.tempFiles&&l.tempFiles.length>0){let t=l.tempFiles[0];this.uploadImage(t.tempFilePath)}}})},uploadImage(e){this.$api.uploadFile(e).then(l=>{this.uploadResult.push(l.url)}).catch(l=>{})},fetchUserCard(){this.$api.fetchUserCard().then(e=>{this.userCard=e}).catch(e=>{})},fetchBuilding(){this.$api.fetchBuildingDetail(this.buildingId).then(e=>{this.buildingDetail=e}).catch(e=>{})},onClickSubmit(){s.index.showModal({title:"提示",content:"是否确认提交登记信息",success:e=>{e.confirm?this.submitCheck():e.cancel}})},submitCheck(){let e="";if(this.uploadResult&&this.uploadResult.length>0)for(var l=0;l<this.uploadResult.length;l++){let t=this.uploadResult[l];t&&t!=""&&(e!=""&&(e=e+","),e=e+t)}this.$api.submitSalesCheck(this.scene,e).then(t=>{this.$msg("提交成功"),setTimeout(()=>{s.index.switchTab({url:"/pages/index/index"})},500)}).catch(t=>{})},checkLogin(){let e=a.cache.getToken();return!e||e==""?(s.index.navigateTo({url:"/pages/login/login"}),!1):!0}}};Array||s.resolveComponent("uni-icons")();const p=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||p();function d(e,l,t,m,i,u){return s.e({a:s.p({type:"person",size:"34rpx",color:"#626162"}),b:i.userCard},i.userCard?{c:s.t(i.userCard.name),d:s.t(i.userCard.phone)}:{},{e:s.p({type:"right",size:"34rpx",color:"rgba(51, 49, 52, .5)"}),f:s.o(r=>u.goFun()),g:s.p({type:"location",size:"34rpx",color:"#626162"}),h:i.userCard&&i.userCard.company},i.userCard&&i.userCard.company?{i:s.t(i.userCard.company)}:{},{j:i.userCard&&i.userCard.address},i.userCard&&i.userCard.address?{k:s.t(i.userCard.address)}:{},{l:i.buildingDetail},i.buildingDetail?{m:s.t(i.buildingDetail.name)}:{},{n:i.uploadResult&&i.uploadResult.length>0},i.uploadResult&&i.uploadResult.length>0?{o:s.f(i.uploadResult,(r,n,o)=>({a:u.getImageUrl(r),b:"bac4a35d-3-"+o,c:s.o(f=>u.onClickDelete(n))})),p:s.p({type:"closeempty",size:"24rpx",color:"#fff"})}:{},{q:!i.uploadResult||i.uploadResult.length<4},!i.uploadResult||i.uploadResult.length<4?{r:s.p({type:"camera-filled",size:"80rpx",color:"rgba(51, 49, 52, .25)"}),s:s.o((...r)=>u.onClickUpload&&u.onClickUpload(...r))}:{},{t:s.o(r=>u.onClickSubmit())})}const g=s._export_sfc(h,[["render",d],["__scopeId","data-v-bac4a35d"],["__file","D:/HBuilderProjects/house/pages/register/register.vue"]]);wx.createPage(g);

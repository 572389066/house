"use strict";const o=require("../../common/vendor.js"),s=require("../../utils/cache.js"),r={data(){return{token:"",phone:""}},onLoad(){this.token=s.cache.getToken(),this.token&&this.token!=""&&this.fetchUserInfo()},methods:{fetchUserInfo(){let e=s.cache.getToken();e&&e!=""?this.$api.fetchUserInfo().then(n=>{this.userInfo=n,n&&(this.phone=n.phone)}).catch(n=>{}):this.userInfo=null},onLoginResult(e){o.index.login({provider:"weixin",onlyAuthorize:!0,success:n=>{const{code:t}=n;this.submitLogin(t,e.detail.code)},fail:n=>{this.$msg("登录失败")}})},submitLogin(e,n){this.$api.submitLogin(e,n).then(t=>{s.cache.saveToken(t),this.$msg("登录成功"),o.index.navigateBack()}).catch(t=>{})},onClickLoginOut(){o.index.showModal({title:"提示",content:"是否确认退出登录",success:e=>{e.confirm?this.loginOut():e.cancel}})},loginOut(){s.cache.saveToken(""),o.index.navigateBack()}}};function u(e,n,t,g,i,c){return o.e({a:i.token&&i.token!=""},i.token&&i.token!=""?o.e({b:!i.phone||i.phone==""},!i.phone||i.phone==""?{}:{c:o.t(i.phone)},{d:o.o((...h)=>c.onClickLoginOut&&c.onClickLoginOut(...h))}):{e:o.o((...h)=>c.onLoginResult&&c.onLoginResult(...h))})}const l=o._export_sfc(r,[["render",u],["__file","D:/HBuilderProjects/house/pages/login/login.vue"]]);wx.createPage(l);

import{E as t,a2 as o,G as i,a3 as e,a4 as s,a5 as a,T as n,n as l,C as c,o as r,c as u,w as d,i as h,a as f,d as m,t as p,e as g}from"./index.50f83746.js";import{_ as D}from"./uni-icons.3d233546.js";import{r as _}from"./uni-app.es.c352a98c.js";import{_ as v}from"./mp-html.9d12c5c6.js";import{u as w}from"./urlUtil.7c805a33.js";import{_ as I}from"./_plugin-vue_export-helper.cdc0426e.js";const P={saveImage:function(t,o){let i=this;uni.authorize({scope:"scope.writePhotosAlbum",success:()=>{i.downLoadImg(t,o)},fail:()=>{uni.getSetting({success:t=>{t.authSetting["scope.writePhotosAlbum"]||i.isAuth()}})}})},downLoadImg:function(n,l){t({title:"加载中"}),o({url:n,success:t=>{i(),200===t.statusCode?0==l?e({filePath:t.tempFilePath,success:function(){s({title:"已保存到相册",icon:"none"})},fail:function(){s({title:"保存失败，请稍后重试",icon:"none"})}}):a({filePath:t.tempFilePath,success:function(){s({title:"已保存到相册",icon:"none"})},fail:function(){s({title:"保存失败，请稍后重试",icon:"none"})}}):s({title:"资源格式错误，请联系管理员",icon:"none"})},fail:t=>{s({title:"保存失败，请联系管理员",icon:"none"})}})},isAuth:function(){n({content:"由于您还没有允许保存图片到您相册里,无法进行保存,请点击确定允许授权",success:t=>{t.confirm&&uni.openSetting({success:t=>{console.log(t.authSetting)}})}})}};const k=I({data:()=>({promotionId:"",promotionDetail:null,videoData:[]}),onLoad(t){this.promotionId=t.id,this.fetchPromotionDetail()},methods:{goupload(){this.checkLogin()&&l({url:"/pages/award/prove?id="+this.promotionId})},fetchPromotionDetail(){this.$api.fetchPromotionDetail(this.promotionId).then((t=>{this.promotionDetail=t,this.getVideo()})).catch((t=>{}))},getVideo(){if(this.promotionDetail&&this.promotionDetail.detail&&""!=this.promotionDetail.detail){let t=[];this.promotionDetail.detail.replace(/<video [^>]*src=['"]([^'"]+)[^>]*>/,(function(o,i){t.push(i)})),this.videoData=t}},onClickDownload(){let t=this.$refs.article.imgList,o=[];if(t&&t.length>0)for(var i=0;i<t.length;i++){let e=t[i];e&&""!=e&&o.push(e)}if(this.videoData&&this.videoData.length>0)for(i=0;i<this.videoData.length;i++){let t=this.videoData[i];t&&""!=t&&o.push(t)}if(0!=o.length)for(i=0;i<o.length;i++){let t=o[i];P.saveImage(t,w.isVideo(t))}else this.$msg("未找到图片/视频资源")},checkLogin(){let t=c.getToken();return!(!t||""==t)||(l({url:"/pages/login/login"}),!1)}}},[["render",function(t,o,i,e,s,a){const n=_(g("uni-icons"),D),l=h,c=_(g("mp-html"),v);return r(),u(l,{class:"a_detail"},{default:d((()=>[f(l,{class:"cont"},{default:d((()=>[f(l,{class:"tips"},{default:d((()=>[f(n,{type:"info",size:"30rpx",color:"#E09A5B"}),f(l,null,{default:d((()=>[m("复制文字与图片分享到朋友圈，截图上传推广证明。得奖励")])),_:1})])),_:1}),f(l,{class:"title"},{default:d((()=>[m(p(s.promotionDetail.title),1)])),_:1}),f(l,{class:"text"},{default:d((()=>[m("9.25至10.7日以露营之名，奔赴城市的浪漫")])),_:1}),f(c,{ref:"article",content:s.promotionDetail.detail},null,8,["content"])])),_:1}),f(l,{class:"common_bottom two"},{default:d((()=>[f(l,{class:"active",onClick:o[0]||(o[0]=t=>a.onClickDownload())},{default:d((()=>[m("导出图片/视频")])),_:1}),f(l,{onClick:a.goupload},{default:d((()=>[m("上传推广证明")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-944ea036"]]);export{k as default};

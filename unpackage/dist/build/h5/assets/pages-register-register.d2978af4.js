import{R as e,n as l,T as s,U as t,C as a,o as i,c as u,w as d,i as o,a as c,s as n,d as r,t as p,b as h,r as f,F as m,j as g,e as _,f as C}from"./index.50f83746.js";import{_ as k}from"./uni-icons.3d233546.js";import{r as y}from"./uni-app.es.c352a98c.js";import{u as b}from"./urlUtil.7c805a33.js";import{_ as R}from"./_plugin-vue_export-helper.cdc0426e.js";const x=R({data:()=>({buildingId:"",scene:"",userCard:null,buildingDetail:null,uploadResult:[]}),onLoad(l){this.buildingId=l.buildingId,this.scene=l.scene,e({title:"登记"}),this.fetchBuilding()},onShow(){this.checkLogin()&&this.fetchUserCard()},methods:{goFun(){l({url:"/pages/register/edit?type=2"})},getImageUrl:e=>b.getImgUrl(e),onClickDelete(e){if(this.uploadResult&&this.uploadResult.length>e){this.uploadResult.splice(e,1);let l=this.uploadResult;this.uploadResult=l}},onClickUpload(){let e=4;this.uploadResult&&(e=4-this.uploadResult.length),e>0&&uni.chooseMedia({count:1,mediaType:["image"],sourceType:["album","camera"],maxDuration:30,camera:"back",sizeType:["compressed"],success:e=>{if(e&&e.tempFiles&&e.tempFiles.length>0){let l=e.tempFiles[0];this.uploadImage(l.tempFilePath)}}})},uploadImage(e){this.$api.uploadFile(e).then((e=>{this.uploadResult.push(e.url)})).catch((e=>{}))},fetchUserCard(){this.$api.fetchUserCard().then((e=>{this.userCard=e})).catch((e=>{}))},fetchBuilding(){this.$api.fetchBuildingDetail(this.buildingId).then((e=>{this.buildingDetail=e})).catch((e=>{}))},onClickSubmit(){s({title:"提示",content:"是否确认提交登记信息",success:e=>{e.confirm?this.submitCheck():e.cancel}})},submitCheck(){let e="";if(this.uploadResult&&this.uploadResult.length>0)for(var l=0;l<this.uploadResult.length;l++){let s=this.uploadResult[l];s&&""!=s&&(""!=e&&(e+=","),e+=s)}this.$api.submitSalesCheck(this.scene,e).then((e=>{this.$msg("提交成功"),t()})).catch((e=>{}))},checkLogin(){let e=a.getToken();return!(!e||""==e)||(l({url:"/pages/login/login"}),!1)}}},[["render",function(e,l,s,t,a,b){const R=y(_("uni-icons"),k),x=o,I=C;return i(),u(x,{class:"register"},{default:d((()=>[c(x,{class:"cont"},{default:d((()=>[c(x,{class:n(["info","active"])},{default:d((()=>[c(x,{class:"li",onClick:l[0]||(l[0]=e=>b.goFun())},{default:d((()=>[c(x,{class:"left"},{default:d((()=>[c(x,{class:"name"},{default:d((()=>[c(R,{type:"person",size:"34rpx",color:"#626162"}),c(x,null,{default:d((()=>[r("基础信息")])),_:1})])),_:1}),c(x,{class:"text"},{default:d((()=>[a.userCard?(i(),u(x,{key:0},{default:d((()=>[r(p(a.userCard.name)+" "+p(a.userCard.phone),1)])),_:1})):(i(),u(x,{key:1,class:"tip"}))])),_:1})])),_:1}),c(R,{type:"right",size:"34rpx",color:"rgba(51, 49, 52, .5)",style:{position:"relative",top:"2rpx"}})])),_:1}),c(x,{class:"li"},{default:d((()=>[c(x,{class:"left"},{default:d((()=>[c(x,{class:"name"},{default:d((()=>[c(R,{type:"location",size:"34rpx",color:"#626162"}),c(x,null,{default:d((()=>[r("所属公司")])),_:1})])),_:1}),c(x,{class:"text"},{default:d((()=>[a.userCard&&a.userCard.company?(i(),u(x,{key:0},{default:d((()=>[r(p(a.userCard.company),1)])),_:1})):(i(),u(x,{key:1})),a.userCard&&a.userCard.address?(i(),u(x,{key:2},{default:d((()=>[r(p(a.userCard.address),1)])),_:1})):(i(),u(x,{key:3}))])),_:1})])),_:1})])),_:1})])),_:1}),a.buildingDetail?(i(),u(x,{key:0,class:"address"},{default:d((()=>[r("项目 "+p(a.buildingDetail.name),1)])),_:1})):(i(),u(x,{key:1,class:"address"},{default:d((()=>[r("项目")])),_:1})),c(x,{class:"photos"},{default:d((()=>[c(x,{class:"title"},{default:d((()=>[r("客户接待照片")])),_:1}),c(x,{class:"ul"},{default:d((()=>[a.uploadResult&&a.uploadResult.length>0?(i(!0),h(m,{key:0},f(a.uploadResult,((e,l)=>(i(),u(x,{class:"img"},{default:d((()=>[c(I,{src:b.getImageUrl(e),mode:"aspectFill"},null,8,["src"]),c(x,{class:"clon",onClick:e=>b.onClickDelete(l)},{default:d((()=>[c(R,{type:"closeempty",size:"16rpx",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),256)):g("",!0),!a.uploadResult||a.uploadResult.length<4?(i(),u(x,{key:1,class:"upload",onClick:b.onClickUpload},{default:d((()=>[c(x,null,{default:d((()=>[c(R,{type:"camera-filled",size:"80rpx",color:"rgba(51, 49, 52, .25)"}),c(x,null,{default:d((()=>[r("上传图片")])),_:1})])),_:1})])),_:1},8,["onClick"])):g("",!0)])),_:1})])),_:1})])),_:1}),c(x,{class:"common_bottom",onClick:l[1]||(l[1]=e=>b.onClickSubmit())},{default:d((()=>[c(x,null,{default:d((()=>[r("提交")])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-123a7fce"]]);export{x as default};

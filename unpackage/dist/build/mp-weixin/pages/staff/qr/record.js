"use strict";const e=require("../../../common/vendor.js"),i=require("../../../utils/urlUtil.js");require("../../../utils/request.js"),require("../../../utils/cache.js");const t={data:()=>({recordData:[],buildingData:[],channelData:[],currentBuilding:null,roleTypeData:[{id:"Customer",name:"客户"},{id:"Sales",name:"中介"}],roleType:null,channel:null,roleTypeTmp:null,channelTmp:null,filterDate:"",filterDateTmp:"",nowTime:0,searchKey:""}),onLoad(){this.nowTime=Date.now(),this.fetchChannel()},onShow(){this.$refs.paging.reload()},methods:{getImageUrl:e=>i.urlUtil.getImgUrlNotSize(e),previewImage(i){let t=this.getPictures(i);0!=t.length&&e.index.previewImage({urls:t,success:e=>{}})},onClickSearch(e){this.searchKey=e.value,this.$refs.paging.reload()},onSearchInput(e){this.searchKey=e,this.$refs.paging.reload()},onSearchClear(e){this.searchKey="",this.$refs.paging.reload()},getDisplayRole(e){if(e&&e.type){if("Customer"==e.type)return"客户";if("Sales"==e.type)return"中介"}return"--"},onDateChange(e){this.filterDateTmp=e,this.$refs.paging.reload()},showBuildingPicker(){this.$refs.buildingPicker.open()},closeBuildingPicker(){this.$refs.buildingPicker.close()},bindCurrentBuilding(e){this.currentBuilding=e,this.closeBuildingPicker(),this.$refs.paging.reload()},showFilterPicker(){this.roleTypeTmp=this.roleType,this.channelTmp=this.channel,this.filterDateTmp=this.filterDate,this.$refs.filterPicker.open()},closeFilterPicker(){this.$refs.filterPicker.close()},isSelectRoleType(e){return this.roleTypeTmp&&e&&this.roleTypeTmp.id==e.id},isSelectChannel(e){return this.channelTmp&&e&&this.channelTmp.id==e.id},onRoleTypeSelected(e){this.roleTypeTmp&&e&&e.id==this.roleTypeTmp.id?this.roleTypeTmp=null:this.roleTypeTmp=e},onChannelSelected(e){this.channelTmp&&e&&this.channelTmp.id==e.id?this.channelTmp=null:this.channelTmp=e},onFilterResetClick(){this.roleTypeTmp=null,this.channelTmp=null,this.filterDateTmp=""},onFilterConfirmClick(){this.roleType=this.roleTypeTmp,this.channel=this.channelTmp,this.filterDate=this.filterDateTmp,this.closeFilterPicker(),this.$refs.paging.reload()},fetchBuilding(e,i){this.$staffApi.fetchBuildingList(e,i,"","","").then((e=>{e.unshift({id:"",name:"全部楼盘"}),this.$refs.buildingPaging.complete(e)})).catch((e=>{this.$refs.buildingPaging.complete(!1)}))},fetchChannel(){this.$staffApi.fetchChannel().then((e=>{this.channelData=e})).catch((e=>{}))},fetchRecord(e,i){let t=this.currentBuilding?this.currentBuilding.id:"",n=this.searchKey,r=this.filterDate,l=this.channel?this.channel.id:"",s=this.roleType?this.roleType.id:"";this.$staffApi.fetchCustomerList(e,i,t,n,r,l,s).then((e=>{this.$refs.paging.complete(e)})).catch((e=>{this.$refs.paging.complete(!1)}))},onItemClick(i){i&&"Customer"==i.type&&e.index.navigateTo({url:"/pages/staff/qr/transfer?record="+encodeURIComponent(JSON.stringify(i))})},getPictures(e){let i=[];if(e&&e.pictures&&e.pictures.length>0)for(var t=0;t<e.pictures.length;t++){let n=e.pictures[t];n&&""!=n&&i.push(this.getImageUrl(n))}return i}}};if(!Array){(e.resolveComponent("uni-search-bar")+e.resolveComponent("z-paging")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-datetime-picker"))()}Math||((()=>"../../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js")+(()=>"../../../uni_modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js"))();const n=e._export_sfc(t,[["render",function(i,t,n,r,l,s){return e.e({a:e.o(s.onClickSearch),b:e.o(s.onSearchInput),c:e.o(s.onSearchClear),d:e.o(s.onSearchClear),e:e.p({placeholder:"请输入登记名称/电话","bg-color":"#ffffff"}),f:e.t(l.currentBuilding?l.currentBuilding.name:"全部楼盘"),g:e.o((e=>s.showBuildingPicker())),h:e.o((e=>s.showFilterPicker())),i:e.f(l.recordData,((i,t,n)=>e.e({a:e.t(i.build_name),b:s.getPictures(i).length>0},(s.getPictures(i).length,{}),{c:e.o((e=>s.previewImage(i))),d:e.t(i.create_time?i.create_time:"--"),e:e.t(i.staff_username?i.staff_username:"--"),f:e.t(i.user_phone?i.user_phone:"--"),g:e.t(s.getDisplayRole(i)),h:e.t(i.channel?i.channel:"--"),i:e.t(i.related_phone?i.related_phone:"--"),j:e.t(i.description?i.description:"--"),k:e.o((e=>s.onItemClick(i)))}))),j:e.sr("paging","5e6007af-0"),k:e.o(s.fetchRecord),l:e.o((e=>l.recordData=e)),m:e.p({"default-page-size":"20",auto:!1,modelValue:l.recordData}),n:e.p({type:"closeempty",size:"20",color:"#999999"}),o:e.o(((...e)=>s.closeBuildingPicker&&s.closeBuildingPicker(...e))),p:e.f(l.buildingData,((i,t,n)=>({a:e.t(i.name),b:e.o((e=>s.bindCurrentBuilding(i)))}))),q:e.sr("buildingPaging","5e6007af-3,5e6007af-2"),r:e.o(s.fetchBuilding),s:e.o((e=>l.buildingData=e)),t:e.p({fixed:!1,modelValue:l.buildingData}),v:e.sr("buildingPicker","5e6007af-2"),w:e.p({type:"bottom"}),x:e.p({type:"closeempty",size:"20",color:"#999999"}),y:e.o(((...e)=>s.closeFilterPicker&&s.closeFilterPicker(...e))),z:e.f(l.roleTypeData,((i,t,n)=>e.e({a:l.roleTypeTmp&&i&&l.roleTypeTmp.id==i.id},l.roleTypeTmp&&i&&l.roleTypeTmp.id==i.id?{b:e.t(i.name),c:e.o((e=>s.onRoleTypeSelected(i)))}:{d:e.t(i.name),e:e.o((e=>s.onRoleTypeSelected(i)))}))),A:e.f(l.channelData,((i,t,n)=>e.e({a:l.channelTmp&&i&&l.channelTmp.id==i.id},l.channelTmp&&i&&l.channelTmp.id==i.id?{b:e.t(i.name),c:e.o((e=>s.onChannelSelected(i)))}:{d:e.t(i.name),e:e.o((e=>s.onChannelSelected(i)))}))),B:l.filterDateTmp&&""!=l.filterDateTmp},l.filterDateTmp&&""!=l.filterDateTmp?{C:e.t(""==l.filterDateTmp?"全部":l.filterDateTmp)}:{},{D:e.o(s.onDateChange),E:e.o((e=>i.single=e)),F:e.p({type:"date",end:l.nowTime,modelValue:i.single}),G:e.o((e=>s.onFilterResetClick())),H:e.o((e=>s.onFilterConfirmClick())),I:e.sr("filterPicker","5e6007af-5"),J:e.p({type:"bottom"})})}]]);wx.createPage(n);

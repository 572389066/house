"use strict";const e=require("../../../utils/cache.js"),t=require("../../../common/vendor.js"),n={data:()=>({channel:null,currentBuilding:null,qrCodeImage:null,role:"1",scene:"",intervalId:null,clientRecord:[],salesRecord:[],toastIntervalId:null,taostClientData:[],toastSalesData:[]}),onLoad(t){t.id&&t.name?this.channel={id:t.id,name:t.name}:this.$msg("获取渠道失败"),this.currentBuilding=e.cache.getCurrentBuilding(),this.currentBuilding||this.$msg("请先选择楼盘"),this.fetchCheckCode()},onUnload(){this.intervalId&&clearInterval(this.intervalId),this.toastIntervalId&&clearInterval(this.toastIntervalId)},methods:{onClickReset(){this.qrCodeImage=null,this.fetchCheckCode()},onChangeRole(){"2"===this.role?this.role="1":this.role="2"},fetchCheckCode(){this.$staffApi.fetchCheckCode(this.currentBuilding.id,this.channel.id).then((e=>{this.qrCodeImage=e,this.scene=e.scene,this.startInterval()})).catch((e=>{this.qrCodeImage=null}))},fetchScanRecord(){this.$staffApi.fetchScanRecord(this.scene).then((e=>{this.clientRecord=e.client,this.salesRecord=e.sales})).catch((e=>{this.clientRecord=[],this.salesRecord=[]}))},startInterval(){let e=this;this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval((function(){e.fetchScanRecord()}),2e3)}}};const l=t._export_sfc(n,[["render",function(e,n,l,r,c,a){return t.e({a:c.channel},c.channel?{b:t.t(c.channel.name)}:{},{c:c.qrCodeImage},c.qrCodeImage?t.e({d:"1"===c.role},"1"===c.role?{e:c.qrCodeImage.client}:"2"===c.role?{g:c.qrCodeImage.sales}:{},{f:"2"===c.role}):{},{h:c.channel&&"2"===c.role},(c.channel&&"2"===c.role||c.role,{}),{i:"1"===c.role,j:"1"===c.role},(c.role,{}),{k:"2"===c.role},(c.role,{}),{l:t.o((e=>a.onChangeRole())),m:t.o((e=>a.onClickReset())),n:"1"===c.role},"1"===c.role?t.e({o:c.clientRecord},c.clientRecord?{p:t.t(c.clientRecord.length)}:{},{q:c.clientRecord},c.clientRecord?{r:t.f(c.clientRecord,((e,n,l)=>({a:t.t(e.phone)})))}:{}):"2"===c.role?t.e({t:c.salesRecord},c.salesRecord?{v:t.f(c.salesRecord,((e,n,l)=>({a:t.t(e.phone)})))}:{}):{},{s:"2"===c.role})}],["__scopeId","data-v-6f4928d3"]]);wx.createPage(l);

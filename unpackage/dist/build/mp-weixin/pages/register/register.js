"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/urlUtil.js"),l=require("../../utils/cache.js");require("../../utils/request.js");const i={data:()=>({buildingId:"",scene:"",userCard:null,buildingDetail:null,uploadResult:[]}),onLoad(t){this.buildingId=t.buildingId,this.scene=t.scene,e.index.setNavigationBarTitle({title:"登记"}),this.fetchBuilding()},onShow(){this.checkLogin()&&this.fetchUserCard()},methods:{goFun(){e.index.navigateTo({url:"/pages/register/edit?type=2"})},getImageUrl:e=>t.urlUtil.getImgUrl(e),onClickDelete(e){if(this.uploadResult&&this.uploadResult.length>e){this.uploadResult.splice(e,1);let t=this.uploadResult;this.uploadResult=t}},onClickUpload(){let t=4;this.uploadResult&&(t=4-this.uploadResult.length),t>0&&e.index.chooseMedia({count:1,mediaType:["image"],sourceType:["album","camera"],maxDuration:30,camera:"back",sizeType:["compressed"],success:e=>{if(e&&e.tempFiles&&e.tempFiles.length>0){let t=e.tempFiles[0];this.uploadImage(t.tempFilePath)}}})},uploadImage(e){this.$api.uploadFile(e).then((e=>{this.uploadResult.push(e.url)})).catch((e=>{}))},fetchUserCard(){this.$api.fetchUserCard().then((e=>{this.userCard=e})).catch((e=>{}))},fetchBuilding(){this.$api.fetchBuildingDetail(this.buildingId).then((e=>{this.buildingDetail=e})).catch((e=>{}))},onClickSubmit(){e.index.showModal({title:"提示",content:"是否确认提交登记信息",success:e=>{e.confirm?this.submitCheck():e.cancel}})},submitCheck(){let t="";if(this.uploadResult&&this.uploadResult.length>0)for(var l=0;l<this.uploadResult.length;l++){let e=this.uploadResult[l];e&&""!=e&&(""!=t&&(t+=","),t+=e)}this.$api.submitSalesCheck(this.scene,t).then((t=>{this.$msg("提交成功"),setTimeout((()=>{e.index.switchTab({url:"/pages/index/index"})}),500)})).catch((e=>{}))},checkLogin(){let t=l.cache.getToken();return!(!t||""==t)||(e.index.navigateTo({url:"/pages/login/login"}),!1)}}};if(!Array){e.resolveComponent("uni-icons")()}Math;const s=e._export_sfc(i,[["render",function(t,l,i,s,a,u){return e.e({a:e.p({type:"person",size:"34rpx",color:"#626162"}),b:a.userCard},a.userCard?{c:e.t(a.userCard.name),d:e.t(a.userCard.phone)}:{},{e:e.p({type:"right",size:"34rpx",color:"rgba(51, 49, 52, .5)"}),f:e.o((e=>u.goFun())),g:e.p({type:"location",size:"34rpx",color:"#626162"}),h:a.userCard&&a.userCard.company},a.userCard&&a.userCard.company?{i:e.t(a.userCard.company)}:{},{j:a.userCard&&a.userCard.address},a.userCard&&a.userCard.address?{k:e.t(a.userCard.address)}:{},{l:a.buildingDetail},a.buildingDetail?{m:e.t(a.buildingDetail.name)}:{},{n:a.uploadResult&&a.uploadResult.length>0},a.uploadResult&&a.uploadResult.length>0?{o:e.f(a.uploadResult,((t,l,i)=>({a:u.getImageUrl(t),b:"1d1ccc73-3-"+i,c:e.o((e=>u.onClickDelete(l)))}))),p:e.p({type:"closeempty",size:"24rpx",color:"#fff"})}:{},{q:!a.uploadResult||a.uploadResult.length<4},!a.uploadResult||a.uploadResult.length<4?{r:e.p({type:"camera-filled",size:"80rpx",color:"rgba(51, 49, 52, .25)"}),s:e.o(((...e)=>u.onClickUpload&&u.onClickUpload(...e)))}:{},{t:e.o((e=>u.onClickSubmit()))})}],["__scopeId","data-v-1d1ccc73"]]);wx.createPage(s);

"use strict";const e=require("../../common/vendor.js"),n=require("../../utils/cache.js"),o={data:()=>({token:"",phone:""}),onLoad(){this.token=n.cache.getToken(),this.token&&""!=this.token&&this.fetchUserInfo()},methods:{fetchUserInfo(){let e=n.cache.getToken();e&&""!=e?this.$api.fetchUserInfo().then((e=>{this.userInfo=e,e&&(this.phone=e.phone)})).catch((e=>{})):this.userInfo=null},onLoginResult(n){e.index.login({provider:"weixin",onlyAuthorize:!0,success:e=>{const{code:o}=e;this.submitLogin(o,n.detail.code)},fail:e=>{this.$msg("登录失败")}})},submitLogin(o,t){this.$api.submitLogin(o,t).then((o=>{n.cache.saveToken(o),this.$msg("登录成功"),e.index.navigateBack()})).catch((e=>{}))},onClickLoginOut(){e.index.showModal({title:"提示",content:"是否确认退出登录",success:e=>{e.confirm?this.loginOut():e.cancel}})},loginOut(){n.cache.saveToken(""),e.index.navigateBack()}}};const t=e._export_sfc(o,[["render",function(n,o,t,i,s,c){return e.e({a:s.token&&""!=s.token},s.token&&""!=s.token?e.e({b:!s.phone||""==s.phone},s.phone&&""!=s.phone?{c:e.t(s.phone)}:{},{d:e.o(((...e)=>c.onClickLoginOut&&c.onClickLoginOut(...e)))}):{e:e.o(((...e)=>c.onLoginResult&&c.onLoginResult(...e)))})}]]);wx.createPage(t);

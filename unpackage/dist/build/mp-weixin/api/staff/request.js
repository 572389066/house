"use strict";const e=require("../../common/vendor.js"),s=require("../../utils/cache.js");let t="";t="https://houseapi.cqsoftware.cn";const o=t=>{let o="";if(t.msg&&""!=t.msg)o=t.msg;else switch(t.code){case 300:o="未授权，请登录";break;case 400:o="请求参数错误";break;case 403:o="跨域拒绝访问";break;case 404:o="请求地址不存在";break;case 500:o="服务器内部错误";break;case 504:o="请求超时";break;default:o="请求失败"}e.index.showToast({title:o,icon:"none",duration:2e3,complete:function(){setTimeout((function(){e.index.hideToast()}),2e3)}}),300==t.code&&setTimeout((function(){s.cache.saveStaffToken(""),e.index.navigateTo({url:"/pages/staff/login/login"})}),2e3)};exports.get=function(n,a={}){let r=s.cache.getStaffToken(),c={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"};return r&&""!=r&&(c.staff=r),console.log("staff ---\x3e>>token= "+r),new Promise(((s,r)=>{e.index.request({url:t+n,data:a,header:c,method:"GET",success:e=>{console.log("get request success: "+JSON.stringify(e));let t=e.data;1==t.code?s(t.return):(r(t),o(t))},fail:e=>{console.log("get request fail: "+JSON.stringify(e)),e&&e.response&&(r(e.response),o(e.response))}})}))},exports.post=function(n,a){let r=s.cache.getStaffToken(),c={"content-type":"application/x-www-form-urlencoded"};return r&&""!=r&&(c.staff=r),new Promise(((s,r)=>{e.index.request({url:t+n,data:a,header:c,method:"POST",success:e=>{console.log("post request success: "+JSON.stringify(e));let t=e.data;1===t.code?s(t.return):(r(t),o(t))},fail:e=>{e&&e.response&&(r(e.response),o(e.response))}})}))},exports.upload=function(s,n){return new Promise(((a,r)=>{e.index.uploadFile({url:t+s,filePath:n,name:"file",formData:{},success:e=>{let s=JSON.parse(e.data);1===s.code?a(s.return):(r(s),o(s))},fail:e=>{e&&e.response&&(r(e),o(e.response))}})}))};

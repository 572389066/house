"use strict";const e=require("../../../../../common/vendor.js"),t=require("./z-paging-static.js"),i=require("./z-paging-constant.js"),s=require("./z-paging-utils.js"),o=require("./modules/data-handle.js"),n=require("./modules/i18n.js"),r=require("./modules/nvue.js"),l=require("./modules/empty.js"),a=require("./modules/refresher.js"),h=require("./modules/load-more.js"),d=require("./modules/loading.js"),u=require("./modules/scroller.js"),g=require("./modules/back-to-top.js"),c=require("./modules/virtual-list.js"),m=require("./z-paging-enum.js"),p=e.index.getSystemInfoSync(),f={name:"z-paging",components:{zPagingRefresh:()=>"../components/z-paging-refresh.js",zPagingLoadMore:()=>"../components/z-paging-load-more.js",zPagingEmptyView:()=>"../../z-paging-empty-view/z-paging-empty-view.js"},mixins:[o.dataHandleModule,n.i18nModule,r.nvueModule,l.emptyModule,a.refresherModule,h.loadMoreModule,d.loadingModule,u.scrollerModule,g.backToTopModule,c.virtualListModule],data:()=>({base64Arrow:t.zStatic.base64Arrow,base64Flower:t.zStatic.base64Flower,base64BackToTop:t.zStatic.base64BackToTop,loadingType:m.Enum.LoadingType.Refresher,requestTimeStamp:0,chatRecordLoadingMoreText:"",wxsPropType:"",renderPropScrollTop:-1,checkScrolledToBottomTimeOut:null,systemInfo:null,cssSafeAreaInsetBottom:-1,cacheTopHeight:-1,insideOfPaging:-1,isLoadFailed:!1,isIos:"ios"===p.platform,disabledBounce:!1,fromCompleteEmit:!1,disabledCompleteEmit:!1,wxsIsScrollTopInTopRange:!0,wxsScrollTop:0,wxsPageScrollTop:0,wxsOnPullingDown:!1}),props:{delay:{type:[Number,String],default:s.u.gc("delay",0)},minDelay:{type:[Number,String],default:s.u.gc("minDelay",0)},pagingStyle:{type:Object,default:function(){return s.u.gc("pagingStyle",{})}},height:{type:String,default:s.u.gc("height","")},width:{type:String,default:s.u.gc("width","")},bgColor:{type:String,default:s.u.gc("bgColor","")},pagingContentStyle:{type:Object,default:function(){return s.u.gc("pagingContentStyle",{})}},autoHeight:{type:Boolean,default:s.u.gc("autoHeight",!1)},autoHeightAddition:{type:[Number,String],default:s.u.gc("autoHeightAddition","0px")},defaultThemeStyle:{type:String,default:s.u.gc("defaultThemeStyle","black")},fixed:{type:Boolean,default:s.u.gc("fixed",!0)},safeAreaInsetBottom:{type:Boolean,default:s.u.gc("safeAreaInsetBottom",!1)},useSafeAreaPlaceholder:{type:Boolean,default:s.u.gc("useSafeAreaPlaceholder",!1)},topZIndex:{type:Number,default:s.u.gc("topZIndex",99)},superContentZIndex:{type:Number,default:s.u.gc("superContentZIndex",1)},contentZIndex:{type:Number,default:s.u.gc("contentZIndex",10)},autoFullHeight:{type:Boolean,default:s.u.gc("autoFullHeight",!0)},watchTouchDirectionChange:{type:Boolean,default:s.u.gc("watchTouchDirectionChange",!1)}},created(){this.createdReload&&!this.refresherOnly&&this.auto&&(this._startLoading(),this._preReload())},mounted(){this.wxsPropType=s.u.getTime().toString(),this.renderJsIgnore,this.createdReload||this.refresherOnly||!this.auto||this.$nextTick((()=>{this._preReload()})),this.finalUseCache&&this._setListByLocalCache();let t=0;t=100,this.$nextTick((()=>{this.systemInfo=e.index.getSystemInfoSync(),!this.usePageScroll&&this.autoHeight&&this._setAutoHeight(),this.loaded=!0})),this.updatePageScrollTopHeight(),this.updatePageScrollBottomHeight(),this._updateLeftAndRightWidth(),this.finalRefresherEnabled&&this.useCustomRefresher&&this.$nextTick((()=>{this.isTouchmoving=!0})),this._onEmit(),this.finalUseVirtualList&&this._virtualListInit(),this.$nextTick((()=>{setTimeout((()=>{this._getCssSafeAreaInsetBottom()}),100)}))},destroyed(){this._offEmit()},unmounted(){this._offEmit()},watch:{defaultThemeStyle:{handler(e){e.length&&(this.finalRefresherDefaultStyle=e)},immediate:!0},autoHeight(e){this.loaded&&!this.usePageScroll&&this._setAutoHeight(e)},autoHeightAddition(e){this.loaded&&!this.usePageScroll&&this.autoHeight&&this._setAutoHeight(e)}},computed:{finalPagingStyle(){const e=this.pagingStyle;if(!this.systemInfo)return e;const t=this.windowTop,i=this.windowBottom;return!this.usePageScroll&&this.fixed&&(t&&!e.top&&(e.top=t+"px"),i&&!e.bottom&&(e.bottom=i+"px")),this.bgColor.length&&!e.background&&(e.background=this.bgColor),this.height.length&&!e.height&&(e.height=this.height),this.width.length&&!e.width&&(e.width=this.width),e},finalLowerThreshold(){return s.u.convertToPx(this.lowerThreshold)},finalPagingContentStyle(){return 1!=this.contentZIndex&&(this.pagingContentStyle["z-index"]=this.contentZIndex,this.pagingContentStyle.position="relative"),this.pagingContentStyle},safeAreaBottom(){if(!this.systemInfo)return 0;let e=0;return e=-1===this.cssSafeAreaInsetBottom?0:this.cssSafeAreaInsetBottom,e},renderJsIgnore(){return(this.usePageScroll&&this.useChatRecordMode||!this.refresherEnabled||!this.useCustomRefresher)&&this.$nextTick((()=>{this.renderPropScrollTop=10})),0},windowHeight(){return this.systemInfo&&this.systemInfo.windowHeight||0},windowTop(){return this.systemInfo&&this.systemInfo.windowTop||0},windowBottom(){if(!this.systemInfo)return 0;let e=this.systemInfo.windowBottom||0;return this.safeAreaInsetBottom&&!this.useSafeAreaPlaceholder&&(e+=this.safeAreaBottom),e},isOldWebView(){try{const e=p.system.split(" "),t=e[0],i=parseInt(e[1].slice(0,1));if("iOS"===t&&i<=10||"Android"===t&&i<=6)return!0}catch(e){return!1}return!1},isIosAndH5:()=>!1,zSlots(){return this.$slots}},methods:{getVersion:()=>`z-paging v${i.c.version}`,setSpecialEffects(e){this.setListSpecialEffects(e)},setListSpecialEffects(e){this.nFixFreezing=e&&Object.keys(e).length,this.isIos&&(this.privateRefresherEnabled=0),this.usePageScroll||this.$refs["zp-n-list"].setSpecialEffects(e)},_doVibrateShort(){e.index.vibrateShort()},async _setAutoHeight(e=!0,t=null){let i="min-height";i="min-height";try{if(e){let e=t||await this._getNodeClientRect(".zp-scroll-view"),o=await this._getNodeClientRect(".zp-page-bottom");if(e){const t=e[0].top;let n=this.windowHeight-t;o&&(n-=o[0].height);const r=n+s.u.convertToPx(this.autoHeightAddition)-(this.insideMore?1:0)+"px !important";this.$set(this.scrollViewStyle,i,r),this.$set(this.scrollViewInStyle,i,r)}}else this.$delete(this.scrollViewStyle,i),this.$delete(this.scrollViewInStyle,i)}catch(o){}},_getCssSafeAreaInsetBottom(){this._getNodeClientRect(".zp-safe-area-inset-bottom").then((e=>{e&&(this.cssSafeAreaInsetBottom=e[0].height,this.safeAreaInsetBottom&&this.updatePageScrollBottomHeight())}))},_updateInsideOfPaging(){this.insideMore&&!0===this.insideOfPaging&&setTimeout((()=>{this.doLoadMore()}),200)},_getNodeClientRect(t,i=!0,s=!1){let o=i?e.index.createSelectorQuery().in(!0===i?this:i):e.index.createSelectorQuery();return s?o.select(t).scrollOffset():o.select(t).boundingClientRect(),new Promise(((e,t)=>{o.exec((t=>{e(!(!t||""==t||null==t||!t.length)&&t)}))}))},_cleanTimeout:e=>(e&&(clearTimeout(e),e=null),e),_onEmit(){e.index.$on(i.c.errorUpdateKey,(()=>{this.loading&&this.complete(!1)})),e.index.$on(i.c.completeUpdateKey,(e=>{setTimeout((()=>{if(this.loading)if(this.disabledCompleteEmit)this.disabledCompleteEmit=!1;else{const t=e.type||"normal",i=e.list||e,s=e.rule;switch(this.fromCompleteEmit=!0,t){case"normal":this.complete(i);break;case"total":this.completeByTotal(i,s);break;case"nomore":this.completeByNoMore(i,s);break;case"key":this.completeByKey(i,s)}}}),1)}))},_offEmit(){e.index.$off(i.c.errorUpdateKey),e.index.$off(i.c.completeUpdateKey)}}};exports._sfc_main=f;
